{"version":3,"file":"pull.components.status.bundle.js","sources":["pull.components.status.js"],"sourcesContent":["import \"./pull.components.status.css\";\n\n/**\n * Bitrix UI\n * Pull connection status Vue component\n *\n * @package bitrix\n * @subpackage pull\n * @copyright 2001-2019 Bitrix\n */\n\nBX.Vue.component('bx-pull-status',\n{\n\t/**\n\t * @emits 'reconnect' {} - work only with props.canReconnect = true\n\t */\n\tprops:\n\t{\n\t\tcanReconnect: { default: false }\n\t},\n\tdata()\n\t{\n\t\treturn {\n\t\t\tstatus: BX.PullClient.PullStatus.Online,\n\t\t\tshowed: null\n\t\t}\n\t},\n\tcreated()\n\t{\n\t\tthis.isMac = navigator.userAgent.toLowerCase().includes('macintosh');\n\n\t\tthis.setStatusTimeout = null;\n\t\tthis.hideTimeout = null;\n\n\t\tthis.pullUnSubscribe = () => {};\n\n\t\tif (typeof this.$root.$bitrixPullClient !== 'undefined')\n\t\t{\n\t\t\tif (this.$root.$bitrixPullClient)\n\t\t\t{\n\t\t\t\tthis.subscribe(this.$root.$bitrixPullClient);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.$root.$on('onBitrixPullClientInited', () => {\n\t\t\t\t\tthis.subscribe(this.$root.$bitrixPullClient);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.subscribe(BX.PULL);\n\t\t}\n\n\t\twindow.component = this;\n\t},\n\tbeforeDestroy()\n\t{\n\t\tthis.pullUnSubscribe();\n\t},\n\tmethods:\n\t{\n\t\tsubscribe(pullClient)\n\t\t{\n\t\t\tthis.pullUnSubscribe = pullClient.subscribe({\n\t\t\t\ttype: BX.PullClient.SubscriptionType.Status,\n\t\t\t\tcallback: event => this.statusChange(event.status)\n\t\t\t});\n\t\t},\n\t\treconnect()\n\t\t{\n\t\t\tif (this.canReconnect)\n\t\t\t{\n\t\t\t\tthis.$emit('reconnect');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tlocation.reload();\n\t\t\t}\n\t\t},\n\t\tstatusChange(status)\n\t\t{\n\t\t\tclearTimeout(this.setStatusTimeout);\n\n\t\t\tif (this.status === status)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tlet validStatus = [\n\t\t\t\tBX.PullClient.PullStatus.Online,\n\t\t\t\tBX.PullClient.PullStatus.Offline,\n\t\t\t\tBX.PullClient.PullStatus.Connecting\n\t\t\t];\n\t\t\tif (validStatus.indexOf(status) < 0)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tlet timeout = 500;\n\n\t\t\tif (status === BX.PullClient.PullStatus.Connecting)\n\t\t\t{\n\t\t\t\ttimeout = 5000;\n\t\t\t}\n\t\t\telse if (status === BX.PullClient.PullStatus.Offline)\n\t\t\t{\n\t\t\t\ttimeout = 2000;\n\t\t\t}\n\n\t\t\tthis.setStatusTimeout = setTimeout(() => {\n\t\t\t\tthis.status = status;\n\t\t\t\tthis.showed = true;\n\t\t\t}, timeout);\n\n\t\t\treturn true;\n\t\t}\n\t},\n\twatch:\n\t{\n\t\tstatus()\n\t\t{\n\t\t\tclearTimeout(this.hideTimeout);\n\t\t\tif (this.status == BX.PullClient.PullStatus.Online)\n\t\t\t{\n\t\t\t\tclearTimeout(this.hideTimeout);\n\t\t\t\tthis.hideTimeout = setTimeout(() => this.showed = false, 4000);\n\t\t\t}\n\t\t}\n\t},\n\tcomputed:\n\t{\n\t\tconnectionClass()\n\t\t{\n\t\t\tlet result = '';\n\t\t\tif (this.showed === true)\n\t\t\t{\n\t\t\t\tresult = \"bx-pull-status-show\";\n\t\t\t}\n\t\t\telse if (this.showed === false)\n\t\t\t{\n\t\t\t\tresult = \"bx-pull-status-hide\";\n\t\t\t}\n\n\t\t\tif (this.status === BX.PullClient.PullStatus.Online)\n\t\t\t{\n\t\t\t\tresult += \" bx-pull-status-online\";\n\t\t\t}\n\t\t\telse if (this.status === BX.PullClient.PullStatus.Offline)\n\t\t\t{\n\t\t\t\tresult += \" bx-pull-status-offline\";\n\t\t\t}\n\t\t\telse if (this.status === BX.PullClient.PullStatus.Connecting)\n\t\t\t{\n\t\t\t\tresult += \" bx-pull-status-connecting\";\n\t\t\t}\n\n\t\t\treturn result;\n\t\t},\n\t\tconnectionText()\n\t\t{\n\t\t\tlet result = '';\n\n\t\t\tif (this.status === BX.PullClient.PullStatus.Online)\n\t\t\t{\n\t\t\t\tresult = this.localize.BX_PULL_STATUS_ONLINE;\n\t\t\t}\n\t\t\telse if (this.status === BX.PullClient.PullStatus.Offline)\n\t\t\t{\n\t\t\t\tresult = this.localize.BX_PULL_STATUS_OFFLINE;\n\t\t\t}\n\t\t\telse if (this.status === BX.PullClient.PullStatus.Connecting)\n\t\t\t{\n\t\t\t\tresult = this.localize.BX_PULL_STATUS_CONNECTING;\n\t\t\t}\n\n\t\t\treturn result;\n\t\t},\n\t\tbutton()\n\t\t{\n\t\t\tlet hotkey = '';\n\t\t\tlet name = '';\n\n\t\t\tif (this.canReconnect)\n\t\t\t{\n\t\t\t\tname = this.localize.BX_PULL_STATUS_BUTTON_RECONNECT;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\thotkey = this.isMac? '&#8984;+R': \"Ctrl+R\";\n\t\t\t\tname = this.localize.BX_PULL_STATUS_BUTTON_RELOAD;\n\t\t\t}\n\n\t\t\treturn {title: name, key: hotkey};\n\t\t},\n\t\tlocalize()\n\t\t{\n\t\t\treturn BX.Vue.getFilteredPhrases('BX_PULL_STATUS_', this.$root.$bitrixMessages);\n\t\t}\n\t},\n\ttemplate: `\n\t\t<div :class=\"['bx-pull-status', connectionClass]\">\n\t\t\t<div class=\"bx-pull-status-wrap\">\n\t\t\t\t<span class=\"bx-pull-status-text\">{{connectionText}}</span>\n\t\t\t\t<span class=\"bx-pull-status-button\" @click=\"reconnect\">\n\t\t\t\t\t<span class=\"bx-pull-status-button-title\">{{button.title}}</span>\n\t\t\t\t\t<span class=\"bx-pull-status-button-key\" v-html=\"button.key\"></span>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t</div>\n\t`\n});"],"names":["BX","Vue","component","props","canReconnect","default","data","status","PullClient","PullStatus","Online","showed","created","isMac","navigator","userAgent","toLowerCase","includes","setStatusTimeout","hideTimeout","pullUnSubscribe","$root","$bitrixPullClient","subscribe","$on","PULL","window","beforeDestroy","methods","pullClient","type","SubscriptionType","Status","callback","event","statusChange","reconnect","$emit","location","reload","clearTimeout","validStatus","Offline","Connecting","indexOf","timeout","setTimeout","watch","computed","connectionClass","result","connectionText","localize","BX_PULL_STATUS_ONLINE","BX_PULL_STATUS_OFFLINE","BX_PULL_STATUS_CONNECTING","button","hotkey","name","BX_PULL_STATUS_BUTTON_RECONNECT","BX_PULL_STATUS_BUTTON_RELOAD","title","key","getFilteredPhrases","$bitrixMessages","template"],"mappings":"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"}